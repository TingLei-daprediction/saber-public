geometry:
  function space: StructuredColumns
  grid:
    type: regular_gaussian
    N: 12
  groups:
  - variables:
    - air_horizontal_streamfunction
    - air_horizontal_velocity_potential
    - air_potential_temperature
    - air_pressure
    - air_pressure_levels_minus_one
    - air_temperature
    - cfeff
    - cleff
    - cloud_liquid_water_mixing_ratio_wrt_dry_air
    - cloud_liquid_water_mixing_ratio_wrt_moist_air_and_condensed_water
    - cloud_ice_mixing_ratio_wrt_dry_air
    - cloud_ice_mixing_ratio_wrt_moist_air_and_condensed_water
    - dlsvpdT
    - dimensionless_exner_function
    - dimensionless_exner_function_levels_minus_one
    - dry_air_density_levels_minus_one
    - eastward_wind
    - geostrophic_pressure_levels_minus_one
    - height_above_mean_sea_level
    - ice_cloud_volume_fraction_in_atmosphere_layer
    - liquid_cloud_volume_fraction_in_atmosphere_layer
    - mu
    - muA
    - muH1
    - muRecipDeterminant
    - muRow1Column1
    - muRow1Column2
    - muRow2Column1
    - muRow2Column2
    - northward_wind
    - qrain
    - qsat
    - qt
    - rain_mixing_ratio_wrt_dry_air
    - rht
    - svp
    - total_water_mixing_ratio_wrt_dry_air
    - unbalanced_pressure_levels_minus_one
    - virtual_potential_temperature
    - water_vapor_mixing_ratio_wrt_dry_air    
    - water_vapor_mixing_ratio_wrt_moist_air_and_condensed_water 
    levels: 70
  - variables:
    - air_pressure_levels
    - height_above_mean_sea_level_levels
    - hydrostatic_exner_levels
    - hydrostatic_pressure_levels
    levels: 71
  partitioner: ectrans
  halo: 1
background error:
  covariance model: hybrid
  components:
  - covariance:
      covariance model: SABER
      adjoint test: false
      ensemble pert:
        date: 2016-01-01T16:00:00Z
        members from template:
          pattern: '%MEM%'
          nmembers: 2
          template:
            date: 2016-01-01T16:00:00Z
            filepath: testdata/process_perts_from_gauss_perts_1/filtered_pert_mb%MEM%_wb2
            variables:
            - eastward_wind
            - mu
            - northward_wind
            - unbalanced_pressure_levels_minus_one
      saber central block:
        saber block name: Ensemble
        localization:
          saber central block:
            saber block name: ID
          saber outer blocks:
          - saber block name: spectral analytical filter
            active variables:
            - eastward_wind__mu__northward_wind__unbalanced_pressure_levels_minus_one
            function:
              horizontal daley length: 1000e3
            normalize filter variance: true
          - saber block name: spectral to gauss
            active variables:
            - eastward_wind__mu__northward_wind__unbalanced_pressure_levels_minus_one
          - saber block name: mo_vertical_localization
            localization data:
              localization matrix file name: testdata/Lv.nc
              localization field name in file: Lv
              pressure file name: testdata/Prho_bar_Mean.nc
              pressure field name in pressure file: Prho_bar_Mean
            number of vertical modes: 10
            reproduce bug non-unit diagonal: true  # To reproduce VAR behaviour
            active variables:
            - eastward_wind__mu__northward_wind__unbalanced_pressure_levels_minus_one
          - saber block name: duplicate variables
            variable groupings:
            - group variable name: eastward_wind__mu__northward_wind__unbalanced_pressure_levels_minus_one
              group components:
              - eastward_wind
              - mu
              - northward_wind
              - unbalanced_pressure_levels_minus_one
          - saber block name: mo vertical interpolation for localization
            inner vertical levels: 70
            active variables:
            - eastward_wind
            - mu
            - northward_wind
            - unbalanced_pressure_levels_minus_one
      saber outer blocks:
      - saber block name: mo_hydrostatic_pressure
        read:
          covariance file path: testdata/FPstats.nc
          number of covariance latitude rings: 481
          gp regression bins: 18
      - saber block name: mo_hydrostatic_pressure_to_hydrostatic_exner
      - saber block name: mo_hydro_bal
      - saber block name: mo_moisture_control
        read:
          covariance file path: testdata/MUstats.nc
      - saber block name: mo_hydrostatic_pressure_hydrostatic_exner_to_pressure_exner
      - saber block name: mo_super_mio
        moisture incrementing operator file: testdata/MIO_coefficients.nc
      - saber block name: mo_dry_air_density
    weight:
      value: 1.0
dirac:
  lon:
  - 180.0
  lat:
  - 3.672
  level:
  - 1
  variable:
  - dry_air_density_levels_minus_one
diagnostic points:
  lon:
  - 180.0
  - 0.0
  - 0.0
  lat:
  - 3.672
  - 84.37
  - 3.672
  level:
  - 1
  - 1
  - 70
  variable:
  - dry_air_density_levels_minus_one
  - dry_air_density_levels_minus_one
  - dry_air_density_levels_minus_one
background:
  date: 2016-01-01T16:00:00Z
  state variables:
  - air_potential_temperature
  - air_pressure
  - air_pressure_levels_minus_one
  - cloud_ice_mixing_ratio_wrt_dry_air
  - cloud_liquid_water_mixing_ratio_wrt_dry_air
  - dimensionless_exner_function
  - dimensionless_exner_function_levels_minus_one
  - height_above_mean_sea_level
  - height_above_mean_sea_level_levels
  - ice_cloud_volume_fraction_in_atmosphere_layer
  - liquid_cloud_volume_fraction_in_atmosphere_layer
  - rain_mixing_ratio_wrt_dry_air
  - water_vapor_mixing_ratio_wrt_dry_air
  filepath: testdata/gauss_state

increment variables:
- air_potential_temperature
- cloud_ice_mixing_ratio_wrt_moist_air_and_condensed_water
- cloud_liquid_water_mixing_ratio_wrt_moist_air_and_condensed_water
- dimensionless_exner_function_levels_minus_one
- dry_air_density_levels_minus_one
- eastward_wind
- northward_wind
- water_vapor_mixing_ratio_wrt_moist_air_and_condensed_water

output dirac:
  mpi pattern: '%MPI%'
  filepath: testdata/dirac_spectralb_gauss_vader_3/dirac_%id%_%MPI%
test:
  reference filename: testref/dirac_spectralb_gauss_vader_3.ref
